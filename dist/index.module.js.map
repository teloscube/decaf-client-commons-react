{"version":3,"file":"index.module.js","sources":["../src/ZendeskWidget.tsx","../src/context.tsx","../src/DecafSpinner.tsx","../src/DecafApp.tsx"],"sourcesContent":["import { useEffect } from 'react';\n\nexport interface ZendeskWidgetProps {\n  /** public zendesk key */\n  zendeskKey: string;\n  /** zendesk widget settings. see:\n   *\n   * https://developer.zendesk.com/api-reference/widget/settings/\n   * */\n  settings?: Record<string, any>;\n}\n\nconst ZENDESK_WIDGET_SCRIPT = 'https://static.zdassets.com/ekr/snippet.js';\n\nexport default function ZendeskWidget(props: ZendeskWidgetProps) {\n  useEffect(() => {\n    if (!props.zendeskKey) return;\n    const script = document.createElement('script');\n    script.src = ZENDESK_WIDGET_SCRIPT + '?key=' + props.zendeskKey;\n    script.async = true;\n    script.id = 'ze-snippet'; // do not change this. zendesk expects this to be ze-snippet\n    document.body.appendChild(script);\n    // @ts-expect-error\n    window.zESettings = props.settings || {};\n    return () => {\n      document.body.removeChild(script);\n    };\n  }, [props]);\n\n  return null;\n}\n","import { buildDecafClient, DecafClient } from '@decafhub/decaf-client';\nimport Cookies from 'js-cookie';\nimport React, { useContext } from 'react';\nimport { DecafContextType, Principal, PublicConfig } from 'types';\n\nexport const DecafContext = React.createContext<DecafContextType>({\n  client: undefined as unknown as DecafClient,\n  me: undefined as unknown as Principal,\n  publicConfig: undefined as unknown as PublicConfig,\n});\n\nexport function DecafProvider({ children, value }: { children: JSX.Element; value: DecafContextType }) {\n  return <DecafContext.Provider value={value}>{children}</DecafContext.Provider>;\n}\n\nexport const useDecaf = () => useContext(DecafContext);\n\n/// ///////////////////////\n// INTERNAL DEFINITIONS //\n/// ///////////////////////\n\nexport function getAuthenticationToken(): string | undefined {\n  // Attempt to get the cookie value:\n  const cookie = Cookies.get('ember_simple_auth-session');\n\n  // If no cookie, return nothing:\n  if (!cookie) {\n    return undefined;\n  }\n\n  try {\n    // Attempt to parse the cookie value:\n    const authinfo = JSON.parse(cookie);\n\n    // Get the token, if any:\n    const token: string | undefined = authinfo?.authenticated?.token;\n\n    // Done, return the token:\n    return token;\n  } catch {\n    console.error('Can not parse authentication information!');\n    return undefined;\n  }\n}\n\nexport function getAuthenticatedDecafClient(): DecafClient | undefined {\n  // Attempt to get the authentication token:\n  const token = getAuthenticationToken();\n\n  // Check token, build client and return:\n  return token ? buildDecafClient('', { token }) : undefined;\n}\n","import React from 'react';\n\nexport type DecafSpinnerType = {\n  title?: string;\n  color?: string;\n  size?: number;\n  titleColor?: string;\n};\n/**\n *\n * @param title string\n * @param color string\n * @param size number\n * @param titleColor string\n * @returns JSX.Element\n */\nexport default function DecafSpinner(props: DecafSpinnerType) {\n  const style = `\n    .spinner-wrapper {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 100vh;\n      flex-direction: column;\n    }\n    .spinner-text {\n      color: ${props.titleColor || '#255d91'};\n    }\n    .spinner {\n      width: ${props.size || '40px'};\n      height: ${props.size || '40px'};\n      position: relative;\n      margin: 10px auto;\n    }\n\n    .double-bounce1,\n    .double-bounce2 {\n      width: 100%;\n      height: 100%;\n      border-radius: 50%;\n      background-color: ${props.color || '#1890ff'};\n      opacity: 0.6;\n      position: absolute;\n      top: 0;\n      left: 0;\n\n      -webkit-animation: sk-bounce 2s infinite ease-in-out;\n      animation: sk-bounce 2s infinite ease-in-out;\n    }\n\n    .double-bounce2 {\n      -webkit-animation-delay: -1s;\n      animation-delay: -1s;\n    }\n\n    @-webkit-keyframes sk-bounce {\n      0%,\n      100% {\n        -webkit-transform: scale(0);\n      }\n      50% {\n        -webkit-transform: scale(1);\n      }\n    }\n\n    @keyframes sk-bounce {\n      0%,\n      100% {\n        transform: scale(0);\n        -webkit-transform: scale(0);\n      }\n      50% {\n        transform: scale(1);\n        -webkit-transform: scale(1);\n      }\n    }\n  `;\n  return (\n    <div className=\"spinner-wrapper\">\n      <style>{style}</style>\n      <div className=\"spinner\">\n        <div className=\"double-bounce1\"></div>\n        <div className=\"double-bounce2\"></div>\n      </div>\n      {props.title && <p className=\"spinner-text\">{props.title}</p>}\n    </div>\n  );\n}\n","import { DecafClient } from '@decafhub/decaf-client';\nimport React, { useEffect } from 'react';\nimport { Principal, PublicConfig } from 'types';\nimport ZendeskWidget from 'ZendeskWidget';\nimport { DecafContext, getAuthenticatedDecafClient } from './context';\nimport DecafSpinner from './DecafSpinner';\n\nexport type DecafAppType = {\n  children: JSX.Element;\n};\n\nexport default function DecafApp(props: DecafAppType) {\n  const [client, setClient] = React.useState<DecafClient | undefined>(undefined);\n  const [me, setMe] = React.useState<Principal | undefined>(undefined);\n  const [publicConfig, setPublicConfig] = React.useState<PublicConfig | undefined>(undefined);\n  const [loading, setLoading] = React.useState(true);\n\n  useEffect(() => {\n    const client = getAuthenticatedDecafClient();\n    if (client) {\n      Promise.all([client.barista.get('/me/'), client.barista.get('/conf/public/')])\n        .then(([meResp, configResp]) => {\n          console.log('meResp', meResp.data);\n          console.log('configResp', configResp.data);\n          setClient(client);\n          setMe(meResp.data);\n          setPublicConfig(configResp.data);\n          setLoading(false);\n        })\n        .catch((err) => {\n          console.log('Failed to load user and public config: ', err.message);\n          setClient(undefined);\n          setMe(undefined);\n          setPublicConfig(undefined);\n          setLoading(false);\n        });\n    } else {\n      setLoading(false);\n      setClient(undefined);\n      setMe(undefined);\n      setPublicConfig(undefined);\n    }\n  }, []);\n\n  if (loading) {\n    return <DecafSpinner title=\"Please Wait...\" />;\n  }\n\n  console.log('DecafApp:', client, me, publicConfig);\n\n  if (client === undefined || me === undefined || publicConfig === undefined) {\n    window.location.href = `/webapps/waitress/production/?next=${window.location.href}`;\n    return null;\n  }\n\n  return (\n    <DecafContext.Provider value={{ client, me, publicConfig }}>\n      {publicConfig.zendesk && (\n        <ZendeskWidget\n          zendeskKey={publicConfig.zendesk}\n          settings={{\n            contactForm: {\n              fields: [\n                {\n                  id: 'name',\n                  prefill: { '*': me.fullname },\n                },\n                {\n                  id: 'email',\n                  prefill: { '*': me.email },\n                },\n              ],\n            },\n          }}\n        />\n      )}\n      {props.children}\n    </DecafContext.Provider>\n  );\n}\n"],"names":["ZendeskWidget","props","useEffect","zendeskKey","script","document","createElement","src","ZENDESK_WIDGET_SCRIPT","async","id","body","appendChild","window","zESettings","settings","removeChild","DecafContext","React","createContext","client","undefined","me","publicConfig","useDecaf","useContext","DecafSpinner","className","titleColor","size","color","title","DecafApp","useState","setClient","setMe","setPublicConfig","loading","setLoading","token","cookie","Cookies","get","authinfo","JSON","parse","authenticated","_authinfo$authenticat","console","error","getAuthenticationToken","buildDecafClient","Promise","all","barista","then","meResp","configResp","log","data","err","message","location","href","Provider","value","zendesk","contactForm","fields","prefill","fullname","email","children"],"mappings":"iJAcwBA,EAAcC,GAepC,OAdAC,EAAU,WACR,GAAKD,EAAME,WAAX,CACA,IAAMC,EAASC,SAASC,cAAc,UAOtC,OANAF,EAAOG,IAAMC,kDAAkCP,EAAME,WACrDC,EAAOK,OAAQ,EACfL,EAAOM,GAAK,aACZL,SAASM,KAAKC,YAAYR,GAE1BS,OAAOC,WAAab,EAAMc,UAAY,cAEpCV,SAASM,KAAKK,YAAYZ,MAE3B,CAACH,aCtBOgB,EAAeC,EAAMC,cAAgC,CAChEC,YAAQC,EACRC,QAAID,EACJE,kBAAcF,IAOHG,EAAW,kBAAMC,EAAWR,aCCjBS,EAAazB,GA6DnC,OACEiB,uBAAKS,UAAU,mBACbT,2OArDSjB,EAAM2B,YAAc,sDAGpB3B,EAAM4B,MAAQ,6BACb5B,EAAM4B,MAAQ,sNAUJ5B,EAAM6B,OAAS,stBAwCnCZ,uBAAKS,UAAU,WACbT,uBAAKS,UAAU,mBACfT,uBAAKS,UAAU,oBAEhB1B,EAAM8B,OAASb,qBAAGS,UAAU,gBAAgB1B,EAAM8B,iBCzEjCC,EAAS/B,GAC/B,MAA4BiB,EAAMe,cAAkCZ,GAA7DD,OAAQc,SACKhB,EAAMe,cAAgCZ,GAAnDC,OAAIa,SAC6BjB,EAAMe,cAAmCZ,GAA1EE,OAAca,SACSlB,EAAMe,UAAS,GAAtCI,OAASC,OA6BhB,OA3BApC,EAAU,WACR,IF6BIqC,EE7BEnB,GF6BFmB,aAxBN,IAAMC,EAASC,EAAQC,IAAI,6BAG3B,GAAKF,EAIL,UAEQG,EAAWC,KAAKC,MAAML,GAM5B,aAHkCG,YAAAA,EAAUG,sBAAVC,EAAyBR,MAI3D,SAEA,YADAS,QAAQC,MAAM,8CAOFC,IAGCC,EAAiB,GAAI,CAAEZ,MAAAA,SAAWlB,EE/B3CD,EACFgC,QAAQC,IAAI,CAACjC,EAAOkC,QAAQZ,IAAI,QAAStB,EAAOkC,QAAQZ,IAAI,mBACzDa,KAAK,gBAAEC,OAAQC,OACdT,QAAQU,IAAI,SAAUF,EAAOG,MAC7BX,QAAQU,IAAI,aAAcD,EAAWE,MACrCzB,EAAUd,GACVe,EAAMqB,EAAOG,MACbvB,EAAgBqB,EAAWE,MAC3BrB,GAAW,WAEN,SAACsB,GACNZ,QAAQU,IAAI,0CAA2CE,EAAIC,SAC3D3B,OAAUb,GACVc,OAAMd,GACNe,OAAgBf,GAChBiB,GAAW,MAGfA,GAAW,GACXJ,OAAUb,GACVc,OAAMd,GACNe,OAAgBf,KAEjB,IAECgB,EACKnB,gBAACQ,GAAaK,MAAM,oBAG7BiB,QAAQU,IAAI,YAAatC,EAAQE,EAAIC,QAEtBF,IAAXD,QAA+BC,IAAPC,QAAqCD,IAAjBE,GAC9CV,OAAOiD,SAASC,2CAA6ClD,OAAOiD,SAASC,WAK7E7C,gBAACD,EAAa+C,UAASC,MAAO,CAAE7C,OAAAA,EAAQE,GAAAA,EAAIC,aAAAA,IACzCA,EAAa2C,SACZhD,gBAAClB,GACCG,WAAYoB,EAAa2C,QACzBnD,SAAU,CACRoD,YAAa,CACXC,OAAQ,CACN,CACE1D,GAAI,OACJ2D,QAAS,CAAE,IAAK/C,EAAGgD,WAErB,CACE5D,GAAI,QACJ2D,QAAS,CAAE,IAAK/C,EAAGiD,aAO9BtE,EAAMuE"}